<!doctype html>
<html lang="en" dir="ltr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <meta name="darkreader-lock" />
  <meta name="color-scheme" content="light dark" />

  <title>Hani Mahfoud | Academic & Research Portfolio</title>
  <meta name="description" content="Academic portfolio and applied research profile: AI, NLP, Big Data. Courses, publications, and professional experience." />

  <meta property="og:title" content="Hani Mahfoud | Academic Portfolio" />
  <meta property="og:description" content="Academic portfolio + applied research experience: AI, NLP, Big Data. Full course syllabi included." />
  <meta property="og:type" content="website" />

  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&family=Inter:wght@300;400;500;600;700&family=Lora:ital,wght@0,400;0,600;1,400&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" referrerpolicy="no-referrer" />

  <script>
    (function(){
      try{
        const t = localStorage.getItem("theme");
        if(t) document.documentElement.setAttribute("data-theme", t);
      }catch(e){}
    })();
  </script>

  <style>
    /* Academic Theme Definitions */
    :root{
      --bg1:#f8fafc; --bg2:#f1f5f9; --bg3:#e2e8f0;
      --primary:#1e3a8a; /* Deep Oxford Blue */
      --secondary:#0f172a;
      --accent:#0284c7;
      --card-bg: #ffffff;
      --border: rgba(15, 23, 42, .08);
      --text: #1e293b; --muted: #475569;
      --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -1px rgba(0, 0, 0, 0.03);
      --radius: 8px; /* Sharper edges for formal look */
      --ring: rgba(30, 58, 138, .3);
      --font-head: 'Lora', 'Cairo', serif;
      --font-body: 'Inter', 'Cairo', sans-serif;
    }
    
    html[data-theme="dark"]{
      --bg1:#0f172a; --bg2:#1e293b; --bg3:#020617;
      --primary:#60a5fa; 
      --secondary:#f8fafc;
      --accent:#38bdf8;
      --card-bg: #1e293b;
      --border: rgba(255, 255, 255, .1);
      --text: #f1f5f9; --muted: #94a3b8;
      --shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.5);
    }

    *{box-sizing:border-box;margin:0;padding:0}
    html{scroll-behavior:smooth}
    body{
      font-family: var(--font-body);
      background: var(--bg1);
      color: var(--text);
      min-height:100vh;
      overflow-x:hidden;
      line-height: 1.6;
      padding-bottom: 80px; /* Space for Botpress launcher */
    }
    h1, h2, h3, .title, .subtitle, .subhead {
      font-family: var(--font-head);
    }
    a{color:var(--primary); text-decoration:none; font-weight: 500;}
    a:hover{text-decoration: underline;}
    
    .container{width:min(1000px, 94%); margin:0 auto}
    
    .card{
      background: var(--card-bg);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 24px;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }
    .card:hover {
      box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
    }

    /* Top bar */
    .topbar{
      position: sticky;
      top: 0;
      width: 100%;
      z-index: 999;
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding:12px 24px;
      background: var(--card-bg);
      border-bottom: 1px solid var(--border);
      box-shadow: 0 1px 2px rgba(0,0,0,0.05);
    }
    .topbar .right{
      display:flex; gap:8px; align-items:center;
      overflow-x:auto; scrollbar-width: none;
    }
    .topbar .right::-webkit-scrollbar{display:none}

    .chip{
      display:inline-flex; align-items:center; gap:8px;
      padding:6px 12px;
      border-radius: 4px;
      background: rgba(30, 58, 138, .05);
      border: 1px solid rgba(30, 58, 138, .1);
      color: var(--primary);
      font-size:.85rem;
      font-weight: 600;
      font-family: var(--font-body);
    }
    .lang-btn, .mini-btn{
      appearance:none;
      border:1px solid var(--border);
      background: transparent;
      color: var(--text);
      padding:6px 12px;
      border-radius: 4px;
      cursor:pointer;
      font-weight:500;
      font-size:.85rem;
      transition:.2s ease;
      font-family: var(--font-body);
      white-space: nowrap;
    }
    .lang-btn:hover, .mini-btn:hover{background: rgba(30, 58, 138, .05);}
    .lang-btn.active{background: var(--primary); color: #fff; border-color: var(--primary);}
    .mini-btn.primary { background: var(--primary); color: #fff; border-color: var(--primary); }
    .mini-btn.primary:hover { filter: brightness(1.1); }
    
    .theme-toggle {
      background: none; border: none; color: var(--text); cursor: pointer; font-size: 1.1rem; padding: 4px 8px;
    }

    /* Hero */
    header.hero{
      padding: 60px 0 40px;
      text-align:center;
      border-bottom: 1px solid var(--border);
      background: var(--card-bg);
    }
    .profile{
      width: 140px; height: 140px; margin:0 auto 20px;
      border-radius: 50%;
      overflow:hidden;
      border: 3px solid var(--border);
    }
    .profile img{width:100%; height:100%; object-fit:cover}
    h1{font-size: 2.2rem; color: var(--secondary); margin-bottom: 5px;}
    .role{color: var(--primary); font-weight:600; font-size: 1.1rem; font-family: var(--font-body);}
    .tagline{margin:15px auto 0; color: var(--muted); max-width: 700px; font-size: 1rem; line-height: 1.7;}
    .cta{margin-top: 25px; display:flex; justify-content:center; gap:12px; flex-wrap:wrap;}

    /* Highlights */
    .highlights{
      margin-top: 40px;
      display:grid;
      grid-template-columns: repeat(4, minmax(0, 1fr));
      gap:20px;
    }
    .hcard{ text-align:center; }
    .hnum{font-size:1.8rem; font-weight:700; color: var(--primary); font-family: var(--font-head);}
    .hlab{color: var(--muted); font-size:.85rem; text-transform: uppercase; letter-spacing: 0.5px; margin-top:4px}
    @media (max-width: 700px){ .highlights{grid-template-columns: repeat(2, minmax(0, 1fr));} }

    /* Nav */
    nav.nav{
      margin: 30px auto;
      padding: 0;
      border-bottom: 2px solid var(--border);
    }
    .nav-row{
      display:flex; gap:20px; flex-wrap:nowrap; overflow-x: auto; scrollbar-width: none; padding-bottom: 1px;
    }
    .nav-row::-webkit-scrollbar{display:none}
    .nav-btn{
      appearance:none; border: none; background: transparent;
      color: var(--muted);
      padding: 12px 0;
      cursor:pointer;
      font-size: 1rem;
      font-weight: 500;
      font-family: var(--font-body);
      white-space: nowrap;
      border-bottom: 2px solid transparent;
      margin-bottom: -2px;
    }
    .nav-btn i{margin-inline-end: 6px; font-size: 0.9em;}
    .nav-btn:hover{color: var(--primary);}
    .nav-btn.active{color: var(--primary); border-bottom-color: var(--primary); font-weight: 600;}

    /* Sections */
    section.panel{display:none; animation: fadeIn .4s ease}
    section.panel.active{display:block;}
    @keyframes fadeIn{from{opacity:0;} to{opacity:1;}}
    
    .title{
      color: var(--secondary);
      font-size: 1.8rem;
      margin-bottom: 24px;
      display: flex; align-items: center; gap: 10px;
    }
    .title i{color: var(--primary); font-size: 1.4rem;}
    
    .grid2{display:grid; grid-template-columns: 1fr 1fr; gap:24px; margin-bottom: 24px;}
    @media (max-width: 800px){ .grid2{grid-template-columns:1fr} }

    .subhead, .subtitle{font-size: 1.2rem; color: var(--secondary); margin-bottom: 12px; border-bottom: 1px solid var(--border); padding-bottom: 6px; display: inline-block;}
    .subhead{margin-top: 20px;}
    .subhead:first-child{margin-top: 0;}
    
    ul.clean, ul.ul{list-style:none; padding:0; margin-bottom: 16px;}
    ul.clean li, ul.ul li{position:relative; padding-inline-start: 20px; margin-bottom: 8px; color: var(--text);}
    ul.clean li::before, ul.ul li::before{content:"■"; position:absolute; inset-inline-start:0; top: 6px; font-size: 0.5em; color: var(--primary);}

    .pillrow{display:flex; flex-wrap:wrap; gap:8px; margin-top: 10px}
    .pill{
      padding: 4px 10px; border-radius: 4px;
      background: var(--bg2); border: 1px solid var(--border);
      font-size:.85rem; color: var(--muted); font-family: monospace;
    }

    /* Teaching & Courses */
    .teach-tools{
      display:flex; gap:12px; flex-wrap:wrap; justify-content:space-between; margin-bottom: 20px;
    }
    .search{
      flex: 1; min-width: 250px; display:flex; align-items:center; gap:10px;
      padding: 8px 12px; border-radius: var(--radius); border: 1px solid var(--border); background: var(--card-bg);
    }
    .search input{ width:100%; border:none; outline:none; background:transparent; color:var(--text); font-family:var(--font-body);}
    .search i{color: var(--muted);}
    
    .course-list{display:grid; gap: 16px;}
    details.course{
      background: var(--card-bg); border: 1px solid var(--border); border-radius: var(--radius);
    }
    details.course summary{
      cursor:pointer; list-style:none; padding: 16px; display:flex; justify-content:space-between; align-items:center;
    }
    details.course summary::-webkit-details-marker{display:none}
    .c-title{font-family: var(--font-head); font-weight:700; font-size:1.1rem; color: var(--secondary);}
    .c-desc{color: var(--muted); font-size: 0.95rem; margin-top: 4px;}
    .badge{font-size:.8rem; background: var(--bg2); padding: 4px 8px; border-radius: 4px; border: 1px solid var(--border); color: var(--muted); white-space: nowrap;}
    
    .course-body{padding: 0 16px 16px; border-top: 1px solid var(--border); margin-top: 10px; padding-top: 16px;}
    .week{padding: 12px; margin-bottom: 12px; background: var(--bg1); border-left: 3px solid var(--primary); border-radius: 0 4px 4px 0;}
    html[dir="rtl"] .week { border-left: none; border-right: 3px solid var(--primary); }
    .week strong{font-family: var(--font-head); color: var(--secondary);}

    pre.code{background: var(--bg1); border:1px solid var(--border); padding:16px; border-radius:var(--radius); overflow-x:auto; font-family: monospace; font-size: 0.9rem;}
    html[dir="rtl"] pre.code{direction:ltr; text-align:left}
    
    footer{padding: 40px 0; text-align:center; color: var(--muted); font-size:.9rem; border-top: 1px solid var(--border); margin-top: 40px;}

    .toast{
      position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%);
      background: var(--secondary); color: var(--bg1); padding: 10px 20px;
      border-radius: 4px; z-index: 9999; display:none; align-items:center; gap:10px; box-shadow: var(--shadow);
    }
    .toast.show{display:flex; animation: fadeIn 0.3s;}
    
    .sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);border:0}
    .hint{font-size: 0.85rem; color: var(--muted); margin-top: 8px; font-style: italic;}
    .actions{display:flex; gap:10px; margin-top: 16px;}
    .chipline{display:flex; gap:10px; margin-top: 12px;}

    /* ===== Botpress: custom always-visible launcher ===== */
/* التصميم الجديد المدمج للزر */
.bp-launcher {
    position: fixed;
    z-index: 3000; 
    bottom: 25px;
    right: 25px;
    display: flex;
    align-items: center;
    /* دمج العنصرين في خلفية واحدة */
    background: var(--card-bg);
    border: 1px solid var(--border);
    border-radius: 50px; /* شكل الكبسولة */
    padding: 5px 15px 5px 5px; /* مسافات داخلية متوازنة */
    box-shadow: var(--shadow);
    cursor: pointer;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    gap: 10px;
}

html[dir="rtl"] .bp-launcher {
    right: auto;
    left: 25px;
    padding: 5px 5px 5px 15px; /* عكس المسافات للغة العربية */
}

/* تنسيق الدائرة الصغيرة داخل الكبسولة */
#bp-toggle-chat {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background: var(--primary); /* لون أزرق من ثيم الموقع */
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    border: none;
    box-shadow: none; /* إزالة الظل الداخلي */
}

#bp-toggle-chat i {
    font-size: 1rem;
    color: #ffffff !important; /* أيقونة بيضاء لتباين أفضل */
}

/* تنسيق النص (اسألني) */
#bp-chat-hint {
    border: none;
    background: transparent;
    box-shadow: none;
    padding: 0;
    font-weight: 600;
    color: var(--text);
    font-size: 0.95rem;
}

/* تأثيرات التفاعل */
.bp-launcher:hover {
    transform: translateY(-3px);
    box-shadow: 0 10px 20px rgba(0,0,0,0.15);
    border-color: var(--primary);
}
  </style>

  <script src="https://cdn.botpress.cloud/webchat/v3.5/inject.js"></script>
  <script src="https://files.bpcontent.cloud/2025/12/20/05/20251220051223-VBGRYYHU.js" defer></script>
</head>

<body>
  <div class="topbar">
    <div class="left">
      <span class="chip" id="audienceChip"><i class="fa-solid fa-university"></i> <span></span></span>
    </div>
    <div class="right" aria-label="Controls">
      <button class="lang-btn" data-lang="ar" type="button">عربي</button>
      <button class="lang-btn" data-lang="en" type="button">EN</button>
      <button class="lang-btn" data-lang="fa" type="button">فارسی</button>
      <button class="lang-btn" data-lang="de" type="button">DE</button>
      <button class="lang-btn" data-lang="fr" type="button">FR</button>
      <button class="lang-btn" data-lang="ro" type="button">RO</button>
      <button class="theme-toggle" id="themeBtn" aria-label="Toggle Theme"><i class="fa-solid fa-moon"></i></button>
    </div>
  </div>

  <header class="hero">
    <div class="container">
      <div class="profile">
        <img src="hani-profile.jpg" alt="Hani Mahfoud" onerror="this.style.display='none';" />
      </div>
      <h1 id="name"></h1>
      <div class="role" id="role"></div>
      <p class="tagline" id="tagline"></p>

      <div class="highlights container" aria-label="Key highlights">
        <div class="hcard">
          <div class="hnum" id="hCourses">—</div>
          <div class="hlab" id="hCoursesLbl"></div>
        </div>
        <div class="hcard">
          <div class="hnum" id="hProjects">—</div>
          <div class="hlab" id="hProjectsLbl"></div>
        </div>
        <div class="hcard">
          <div class="hnum" id="hPubs">—</div>
          <div class="hlab" id="hPubsLbl"></div>
        </div>
        <div class="hcard">
          <div class="hnum"><i class="fa-solid fa-flask"></i></div>
          <div class="hlab" id="hLabLbl">Applied AI</div>
        </div>
      </div>
    </div>
  </header>

  <nav class="nav container" aria-label="Primary">
    <div class="nav-row" role="tablist">
      <button class="nav-btn active" data-panel="academic" type="button"><i class="fa-solid fa-landmark"></i> <span data-i18n="nav_academic"></span></button>
      <button class="nav-btn" data-panel="research" type="button"><i class="fa-solid fa-book-journal-whills"></i> <span data-i18n="nav_research"></span></button>
      <button class="nav-btn" data-panel="teaching" type="button"><i class="fa-solid fa-chalkboard-user"></i> <span data-i18n="nav_teaching"></span></button>
      <button class="nav-btn" data-panel="experience" type="button"><i class="fa-solid fa-industry"></i> <span data-i18n="nav_experience"></span></button>
      <button class="nav-btn" data-panel="projects" type="button"><i class="fa-solid fa-laptop-code"></i> <span data-i18n="nav_projects"></span></button>
      <button class="nav-btn" data-panel="skills" type="button"><i class="fa-solid fa-microchip"></i> <span data-i18n="nav_skills"></span></button>
      <button class="nav-btn" data-panel="contact" type="button"><i class="fa-solid fa-envelope"></i> <span data-i18n="nav_contact"></span></button>
    </div>
  </nav>

  <main class="container">
    
    <section id="academic" class="panel active" role="tabpanel">
      <div class="title"><i class="fa-solid fa-landmark"></i> <span data-i18n="acad_title"></span></div>
      <div class="grid2">
        <div class="card">
          <div class="subhead" data-i18n="acad_teaching_title"></div>
          <p id="acadTeachingP" style="margin-bottom: 12px; color: var(--muted);"></p>
          <ul class="clean" id="acadTeachingBullets"></ul>
          <div class="actions">
            <button class="mini-btn primary" type="button" data-jump="teaching"><i class="fa-solid fa-chalkboard-user"></i> <span data-i18n="acad_cta_teaching"></span></button>
          </div>
        </div>
        <div class="card">
          <div class="subhead" data-i18n="acad_research_title"></div>
          <p id="acadResearchP" style="margin-bottom: 12px; color: var(--muted);"></p>
          <ul class="clean" id="acadResearchBullets"></ul>
          <div class="actions">
            <button class="mini-btn primary" type="button" data-jump="research"><i class="fa-solid fa-book-open"></i> <span data-i18n="acad_cta_research"></span></button>
          </div>
        </div>
      </div>
      <div class="card">
         <div class="subhead" data-i18n="ov_title"></div>
         <p id="ovPitch"></p>
         <div class="pillrow" id="ovPills" style="margin-top: 15px;"></div>
      </div>
    </section>

    <section id="research" class="panel" role="tabpanel">
      <div class="title"><i class="fa-solid fa-book-journal-whills"></i> <span data-i18n="res_title"></span></div>
      <div class="grid2">
        <div class="card">
          <div class="subhead" id="resIntroTitle"></div>
          <ul class="clean" id="resList"></ul>
        </div>
        <div class="card">
          <div class="subhead" data-i18n="res_links"></div>
          <ul class="clean">
            <li><a id="scholarLink" target="_blank" rel="noreferrer"><i class="fa-solid fa-graduation-cap"></i> <span data-i18n="res_scholar"></span></a></li>
          </ul>
          <div class="subhead" data-i18n="res_keywords"></div>
          <div class="pillrow" id="resPills"></div>
        </div>
      </div>
    </section>

    <section id="teaching" class="panel" role="tabpanel">
      <div class="title"><i class="fa-solid fa-chalkboard-user"></i> <span data-i18n="teach_title"></span></div>
      
      <div class="card" style="margin-bottom: 24px;">
        <p id="teachIntro" style="margin-bottom: 15px;"></p>
        <div class="grid2" style="margin-bottom: 0;">
          <div>
            <div class="subhead" data-i18n="teach_focus"></div>
            <ul class="clean" id="teachFocus"></ul>
          </div>
          <div>
            <div class="subhead" data-i18n="teach_delivery"></div>
            <ul class="clean" id="teachDelivery"></ul>
          </div>
        </div>
      </div>

      <div class="teach-tools">
        <div class="search" role="search">
          <i class="fa-solid fa-search"></i>
          <input id="courseSearch" type="search" placeholder="Search courses / ابحث عن مساق..." />
        </div>
        <button class="mini-btn" id="expandAllBtn" type="button"><i class="fa-solid fa-list"></i> <span data-i18n="teach_expand"></span></button>
      </div>

      <div id="courseList" class="course-list"></div>
      <p class="hint" id="teachTranslateHint" style="text-align: center; margin-top: 15px;"></p>
    </section>

    <section id="experience" class="panel" role="tabpanel">
      <div class="title"><i class="fa-solid fa-industry"></i> <span data-i18n="exp_title"></span></div>
      
      <div class="card" style="margin-bottom: 24px;">
        <p id="expIntro"></p>
      </div>

      <div class="grid2">
        <div class="card">
          <div class="subhead" data-i18n="exp_strengths"></div>
          <ul class="clean" id="expStrengths"></ul>
        </div>
        <div class="card">
          <div class="subhead" data-i18n="exp_domains"></div>
          <ul class="clean" id="expDomains"></ul>
          <div class="subhead" data-i18n="exp_examples"></div>
          <ul class="clean" id="expExamples"></ul>
        </div>
      </div>
    </section>

    <section id="projects" class="panel" role="tabpanel">
      <div class="title"><i class="fa-solid fa-laptop-code"></i> <span data-i18n="proj_title"></span></div>
      <div class="grid2">
        <div class="card">
          <div class="subhead" id="projIntroTitle"></div>
          <ul class="clean" id="projList"></ul>
        </div>
        <div class="card">
          <div class="subhead" data-i18n="proj_stack"></div>
          <div class="pillrow" id="projPills"></div>
          <div class="subhead" data-i18n="proj_value"></div>
          <ul class="clean" id="projValue"></ul>
        </div>
      </div>
    </section>

    <section id="skills" class="panel" role="tabpanel">
      <div class="title"><i class="fa-solid fa-microchip"></i> <span data-i18n="skills_title"></span></div>
      <div class="grid2">
        <div class="card">
          <div class="subhead" data-i18n="skills_core"></div>
          <ul class="clean" id="skillsCore"></ul>
          <div class="subhead" data-i18n="skills_tools"></div>
          <div class="pillrow" id="skillsPills"></div>
        </div>
        <div class="card">
          <div class="subhead" data-i18n="skills_soft"></div>
          <ul class="clean" id="skillsSoft"></ul>
          <div class="subhead" data-i18n="skills_langs"></div>
          <ul class="clean" id="skillsLangs"></ul>
        </div>
      </div>
    </section>

    <section id="contact" class="panel" role="tabpanel">
      <div class="title"><i class="fa-solid fa-envelope"></i> <span data-i18n="contact_title"></span></div>
      <div class="card" style="text-align: center; padding: 40px 20px;">
        <p id="contactIntro" style="font-size: 1.1rem; margin-bottom: 20px;"></p>
        <ul class="clean" id="contactList" style="display: inline-block; text-align: start; margin-bottom: 30px;"></ul>
        <div style="display:flex; justify-content:center; gap:15px; flex-wrap:wrap">
          <a class="mini-btn primary" id="mailBtn" style="padding: 10px 20px; font-size: 1rem;"><i class="fa-solid fa-envelope"></i> <span data-i18n="contact_email"></span></a>
          <a class="mini-btn" id="waBtn" target="_blank" rel="noreferrer" style="padding: 10px 20px; font-size: 1rem;"><i class="fa-brands fa-whatsapp"></i> <span data-i18n="contact_whatsapp"></span></a>
        </div>
      </div>
    </section>

  </main>

  <footer>
    <div class="container">
      <span id="footerText"></span>
    </div>
  </footer>

  <div class="toast" id="toast"><i class="fa-solid fa-check"></i> <span id="toastText"></span></div>

  <div class="bp-launcher" aria-label="Site chat launcher">
    <button id="bp-toggle-chat" type="button" aria-label="Open chat">
      <i class="fa-solid fa-comment-dots" aria-hidden="true"></i>
    </button>
    <span id="bp-chat-hint" role="button" tabindex="0" aria-label="Open chat">اسألني</span>
  </div>

<script>
/* ========= Profile Data ========= */
const PROFILE = {
  name: { ar: "هاني أكرم محفوض", en: "Hani Akram Mahfoud" },
  role: {
    ar: "أكاديمي وباحث | الذكاء الاصطناعي، معالجة اللغات الطبيعية، والبيانات الضخمة",
    en: "Academic & Researcher | AI, NLP & Big Data"
  },
  tagline: {
    ar: "أجمع بين الرصانة الأكاديمية في تدريس علوم الحاسوب والبحث العلمي التطبيقي، مع التركيز على بناء حلول ذكية قابلة للنشر تسد الفجوة بين النظرية والتطبيق الصناعي.",
    en: "Bridging computer science education with applied scientific research. Focused on developing deployable AI solutions that close the gap between theoretical rigor and industrial application."
  },
  location: { ar: "العراق — البصرة", en: "Iraq — Basrah" },
  email: "hani.mahfoud.904@gmail.com",
  whatsapp: "https://wa.me/9647776251552",
  scholar: "https://scholar.google.com/citations?user=ARJ_H2YAAAAJ&hl=ar"
};

const BASE_CONTENT = {
  overview: {
    pitch: {
      ar: "هذا الملف مصمم كلائحة أكاديمية ومهنية تفصيلية للجان التوظيف الجامعية والبحثية. يضم خطط تدريسية شاملة لـ 16 أسبوعاً، منهجيات التقييم، ملخصاً للمنشورات البحثية، بالإضافة إلى خبرة تطبيقية في ربط تقنيات الذكاء الاصطناعي ببيانات التشغيل الصناعية (Applied Research).",
      en: "This portfolio is structured as a comprehensive academic and professional dossier for university hiring and research committees. It features full 16-week course syllabi, assessment methodologies, research publications, and applied industry experience bridging AI with operational data."
    },
    pills: ["AI & Machine Learning", "Natural Language Processing", "Big Data Analytics", "Curriculum Development", "Applied Research"]
  },
  academic: {
    teaching_p: {
      ar: "منهجية تدريس مبنية على الموازنة بين الأسس النظرية العميقة والتطبيق العملي المكثف، مع توفير خطط دراسية جاهزة وتقييمات قائمة على المشاريع.",
      en: "A pedagogical approach balancing deep theoretical foundations with intensive hands-on application, backed by ready-to-deploy syllabi and project-based assessments."
    },
    teaching_bullets: {
      ar: [
        "إعداد مناهج متكاملة (16 أسبوع) لمواد: الذكاء الاصطناعي، تعلم الآلة، NLP، وهياكل البيانات.",
        "تنمية مهارات التفكير النقدي وحل المشكلات الهندسية المعقدة لدى الطلاب.",
        "دمج التعلم القائم على المشاريع (PBL) باستخدام بيانات واقعية."
      ],
      en: [
        "Developed full 16-week curricula for AI, ML, NLP, and Data Structures.",
        "Fostering critical thinking and complex engineering problem-solving in students.",
        "Integrating Project-Based Learning (PBL) utilizing real-world datasets."
      ]
    },
    research_p: {
      ar: "تركز اهتماماتي البحثية على النمذجة التنبؤية، معالجة اللغات الطبيعية (للغات السامية والمحولات)، وتحليلات البيانات التشغيلية الصناعية.",
      en: "My research interests center on predictive modeling, NLP (Semitic languages and transformers), and industrial operational analytics."
    },
    research_bullets: {
      ar: [
        "النمذجة التنبؤية للسلاسل الزمنية (Time-Series) وهياكل التعلم العميق.",
        "تحليل الدلالات وتصنيف النصوص باستخدام نماذج Transformers للغة العربية.",
        "الاستدلال التشغيلي والصيانة التنبؤية للأنظمة الصناعية المعقدة."
      ],
      en: [
        "Time-Series predictive modeling and deep learning architectures.",
        "Semantic analysis and text classification using Transformers for Arabic.",
        "Operational intelligence and predictive maintenance for complex industrial systems."
      ]
    }
  },
  teaching: {
    intro: {
      ar: "تتضمن هذه المحفظة مخططات تدريسية معيارية لـ 22 مساقاً أكاديمياً. كل مساق مدعّم بخطة توزيع على 16 أسبوعاً، مخرجات تعلم واضحة، ومنهجيات تقييم.",
      en: "This portfolio includes standard teaching syllabi for 22 academic courses. Each features a 16-week distribution plan, clear learning outcomes, and assessment methodologies."
    },
    focus: {
      ar: ["تأصيل النظريات العلمية + مختبرات عملية + مشروع تخرج ختامي.", "معايير تقييم (Rubrics) واضحة وشفافة لضمان الجودة الأكاديمية.", "استخدام دراسات حالة منشورة لتضييق الفجوة بين الأكاديميا والصناعة."],
      en: ["Theoretical grounding + practical labs + capstone projects.", "Transparent assessment rubrics ensuring academic quality.", "Utilizing published case studies to narrow the academia-industry gap."]
    },
    delivery: {
      ar: ["محاضرات نظرية مدعمة بتطبيقات بايثون الحية.", "التقييم المستمر: أبحاث قصيرة، اختبارات دورية، ومناقشات علمية.", "نظام الساعات المكتبية والتوجيه المباشر للطلاب."],
      en: ["Theoretical lectures supported by live Python implementations.", "Continuous assessment: short papers, periodic quizzes, and scientific discussions.", "Structured office hours and direct student mentorship."]
    },
    translateHint: {
      ar: "ملاحظة: الخطط الأكاديمية يتم ترجمتها آلياً عند توسيع المساق لتسريع تحميل الموقع.",
      en: "Note: Academic syllabi are translated on-the-fly when expanded to optimize load times."
    }
  },
  experience: {
    intro: {
      ar: "إلى جانب مسيرتي الأكاديمية، أمتلك خبرة عملية في تطبيق خوارزميات الذكاء الاصطناعي وتحليل البيانات الضخمة ضمن البيئات الصناعية والتشغيلية (Applied Industry Experience).",
      en: "Complementing my academic career, I hold practical experience in applying AI algorithms and big data analytics within industrial and operational environments (Applied Industry Experience)."
    },
    strengths: {
      ar: [
        "بناء نماذج الكشف المبكر عن الأعطال (Anomaly Detection) للمعدات الثقيلة.",
        "تحليل سجلات SCADA وتطوير تقارير تشغيلية ذكية تدعم اتخاذ القرار.",
        "تصميم لوحات قياس (Dashboards) تحليلية تعتمد على البيانات الحية."
      ],
      en: [
        "Building early-warning Anomaly Detection models for heavy machinery.",
        "Analyzing SCADA logs to develop intelligent, decision-supporting operational reports.",
        "Designing analytical dashboards powered by live telemetry data."
      ]
    },
    domains: {
      ar: ["تحليل الإشارات التشغيلية (Time-Series) والتنبؤ بالأحمال.", "ذكاء الوثائق (Document Intelligence) للتقارير الفنية الهندسية.", "الأنظمة الخبيرة وإدارة المعرفة المؤسسية."],
      en: ["Operational signal analysis (Time-Series) and load forecasting.", "Document Intelligence for technical and engineering reports.", "Expert systems and enterprise knowledge management."]
    },
    examples: {
      ar: ["تحويل بيانات الحساسات (ضغط/حرارة) إلى مؤشرات للصيانة التنبؤية (Predictive Maintenance).", "أتمتة تلخيص وتصنيف إنذارات التشغيل لتقليل زمن الاستجابة."],
      en: ["Transforming sensor telemetry (pressure/temp) into Predictive Maintenance indicators.", "Automating the summarization and triage of operational alarms to reduce response time."]
    }
  },
  research: {
    intro: { ar: "مختارات من الإسهامات البحثية والمنشورات:", en: "Selected Research Contributions & Publications:" },
    list: [
      { k: "Autism Detection", ar: "نموذج فعال لاكتشاف طيف التوحد باستخدام تعلم الآلة المتقدم.", en: "An effective autism spectrum disorder detection model using advanced machine learning." },
      { k: "NER & Discourse", ar: "تحديد عناصر الخطاب في الكتابة الأكاديمية باستخدام معمارية Longformer.", en: "Identifying discourse elements in academic writing using Longformer architecture." },
      { k: "AraBERT Study", ar: "تقييم أداء AraBERT في اكتشاف اللهجات وتحليل المشاعر للغة العربية.", en: "Performance evaluation of AraBERT for dialect detection and sentiment analysis." }
    ],
    pills: ["Transformers", "Arabic NLP", "Time-series", "Data Mining", "AI Ethics"]
  },
  projects: {
    intro: { ar: "حلول تطبيقية وأنظمة تم تطويرها:", en: "Applied Solutions & Developed Systems:" },
    list: [
      { k: "Sentiment Analysis Engine", ar: "نماذج متقدمة لتحليل المشاعر للنصوص العربية المتباينة.", en: "Advanced sentiment analysis models for heterogeneous Arabic texts." },
      { k: "Automated Text Classifier", ar: "نظام آلي لتصنيف الوثائق الأكاديمية بدقة عالية.", en: "High-accuracy automated classification system for academic documents." }
    ],
    stack: ["Python", "TensorFlow/Keras", "PyTorch", "HuggingFace", "SQL", "Spark"],
    value: {
      ar: ["تطوير نماذج قابلة للتوسعة والنشر (Scalable Deployment).", "تحقيق معايير دقة عالية (Precision/Recall).", "أتمتة العمليات التحليلية المعقدة."],
      en: ["Developing scalable and deployable models.", "Achieving high accuracy metrics (Precision/Recall).", "Automating complex analytical pipelines."]
    }
  },
  skills: {
    core: {
      ar: ["أساسيات علوم الحاسوب والخوارزميات", "تعلم الآلة والتعلم العميق", "معالجة اللغات الطبيعية (NLP)", "تصميم وتطوير المناهج الأكاديمية", "تحليل البيانات التشغيلية"],
      en: ["Computer Science Fundamentals & Algorithms", "Machine Learning & Deep Learning", "Natural Language Processing (NLP)", "Academic Curriculum Development", "Operational Data Analytics"]
    },
    tools: ["Python", "PyTorch", "TensorFlow", "scikit-learn", "SQL", "Git", "Power BI"],
    soft: {
      ar: ["التدريس والتوجيه الأكاديمي", "كتابة الأبحاث العلمية", "العمل البحثي المشترك", "التواصل التقني للعموم"],
      en: ["Teaching & Mentorship", "Scientific Writing", "Collaborative Research", "Technical Communication"]
    },
    langs: {
      ar: ["العربية (اللغة الأم)", "الإنجليزية (إجادة مهنية وأكاديمية)", "الفارسية (إجادة عمل)"],
      en: ["Arabic (Native)", "English (Professional & Academic Proficiency)", "Persian (Working Proficiency)"]
    }
  },
  contact: {
    intro: {
      ar: "للتواصل الأكاديمي، الفرص البحثية، أو المقابلات:",
      en: "For academic inquiries, research collaborations, or interviews:"
    }
  }
};

const UI = {
  ar: {
    audience: "لجان التعيين الأكاديمية",
    nav_academic: "الملخص الأكاديمي",
    nav_research: "البحوث والمنشورات",
    nav_teaching: "التدريس الأكاديمي",
    nav_experience: "التطبيق الصناعي",
    nav_projects: "المشاريع",
    nav_skills: "المهارات",
    nav_contact: "تواصل",
    acad_title: "الملخص الأكاديمي",
    acad_teaching_title: "التدريس والمناهج",
    acad_research_title: "الاهتمامات البحثية",
    acad_cta_teaching: "استعرض الخطط التدريسية",
    acad_cta_research: "استعرض الأبحاث",
    ov_title: "فلسفة العمل والمنهجية",
    res_title: "البحوث والمنشورات",
    res_links: "الملفات الشخصية الأكاديمية",
    res_scholar: "Google Scholar",
    res_keywords: "الكلمات المفتاحية البحثية",
    teach_title: "مخططات التدريس (Syllabi)",
    teach_focus: "المنهجية الأكاديمية",
    teach_delivery: "آلية التقييم والتقديم",
    teach_expand: "عرض/طي الخطط",
    exp_title: "الخبرة التطبيقية والصناعية",
    exp_strengths: "المساهمات التشغيلية",
    exp_domains: "مجالات التطبيق الصناعي",
    exp_examples: "أمثلة تطبيقية",
    proj_title: "مشاريع تقنية تطبيقية",
    proj_stack: "التقنيات المستخدمة",
    proj_value: "القيمة العلمية والعملية",
    skills_title: "المهارات الأكاديمية والتقنية",
    skills_core: "المجالات الرئيسية",
    skills_tools: "الأدوات البرمجية",
    skills_soft: "مهارات أكاديمية وبحثية",
    skills_langs: "اللغات",
    contact_title: "تواصل معي",
    contact_email: "إرسال بريد إلكتروني",
    contact_whatsapp: "مراسلة عبر واتساب",
    hCoursesLbl: "خطة مساق",
    hProjectsLbl: "مشاريع",
    hPubsLbl: "منشورات",
    footer: "© " + new Date().getFullYear() + " — Hani Mahfoud. Designed for academic and research committees.",
    toastTranslated: "تمت الترجمة آلياً ✓"
  },
  en: {
    audience: "Academic & Research Committees",
    nav_academic: "Academic Profile",
    nav_research: "Research",
    nav_teaching: "Teaching Syllabi",
    nav_experience: "Applied Industry",
    nav_projects: "Projects",
    nav_skills: "Skills",
    nav_contact: "Contact",
    acad_title: "Academic Profile",
    acad_teaching_title: "Curriculum & Teaching",
    acad_research_title: "Research Focus",
    acad_cta_teaching: "View Teaching Syllabi",
    acad_cta_research: "View Publications",
    ov_title: "Methodology & Philosophy",
    res_title: "Research & Publications",
    res_links: "Academic Profiles",
    res_scholar: "Google Scholar",
    res_keywords: "Research Keywords",
    teach_title: "Teaching Syllabi (16-Week Plans)",
    teach_focus: "Academic Methodology",
    teach_delivery: "Delivery & Assessment",
    teach_expand: "Expand/Collapse Plans",
    exp_title: "Applied Industrial Experience",
    exp_strengths: "Operational Contributions",
    exp_domains: "Industrial Domains",
    exp_examples: "Applied Examples",
    proj_title: "Technical Projects",
    proj_stack: "Technology Stack",
    proj_value: "Scientific & Practical Value",
    skills_title: "Technical & Academic Skills",
    skills_core: "Core Disciplines",
    skills_tools: "Software & Tools",
    skills_soft: "Academic & Soft Skills",
    skills_langs: "Languages",
    contact_title: "Get in Touch",
    contact_email: "Send Email",
    contact_whatsapp: "Message via WhatsApp",
    hCoursesLbl: "Course Syllabi",
    hProjectsLbl: "Projects",
    hPubsLbl: "Publications",
    footer: "© " + new Date().getFullYear() + " — Hani Mahfoud. Designed for academic and research committees.",
    toastTranslated: "Auto-translated ✓"
  },
  fa: {
    audience: "کمیته‌های علمی و پژوهشی",
    nav_academic: "پروفایل آکادمیک",
    nav_research: "پژوهش‌ها",
    nav_teaching: "طرح درس‌ها",
    nav_experience: "تجربه صنعتی",
    nav_projects: "پروژه‌ها",
    nav_skills: "مهارت‌ها",
    nav_contact: "تماس",
    acad_title: "پروفایل آکادمیک",
    acad_teaching_title: "تدریس و برنامه درسی",
    acad_research_title: "حوزه پژوهشی",
    acad_cta_teaching: "مشاهده طرح درس‌ها",
    acad_cta_research: "مشاهده مقالات",
    ov_title: "روش‌شناسی و فلسفه",
    res_title: "پژوهش‌ها و مقالات",
    res_links: "لینک‌های آکادمیک",
    res_scholar: "گوگل اسکولار",
    res_keywords: "کلمات کلیدی",
    teach_title: "طرح درس‌ها (برنامه ۱۶ هفته‌ای)",
    teach_focus: "روش‌شناسی آکادمیک",
    teach_delivery: "ارائه و ارزیابی",
    teach_expand: "باز/بسته کردن همه",
    exp_title: "تجربه کاربردی و صنعتی",
    exp_strengths: "دستاوردهای عملیاتی",
    exp_domains: "حوزه‌های صنعتی",
    exp_examples: "نمونه‌های کاربردی",
    proj_title: "پروژه‌های فنی",
    proj_stack: "فناوری‌ها",
    proj_value: "ارزش علمی و عملی",
    skills_title: "مهارت‌های فنی و آکادمیک",
    skills_core: "حوزه‌های اصلی",
    skills_tools: "نرم‌افزارها و ابزارها",
    skills_soft: "مهارت‌های پژوهشی",
    skills_langs: "زبان‌ها",
    contact_title: "تماس با من",
    contact_email: "ارسال ایمیل",
    contact_whatsapp: "پیام در واتساپ",
    hCoursesLbl: "طرح درس",
    hProjectsLbl: "پروژه‌ها",
    hPubsLbl: "مقالات",
    footer: "© " + new Date().getFullYear() + " — Hani Mahfoud.",
    toastTranslated: "ترجمه خودکار ✓"
  },
  de: {
    audience: "Akademische Komitees",
    nav_academic: "Akademisches Profil",
    nav_research: "Forschung",
    nav_teaching: "Lehrpläne",
    nav_experience: "Industrieerfahrung",
    nav_projects: "Projekte",
    nav_skills: "Kompetenzen",
    nav_contact: "Kontakt",
    acad_title: "Akademisches Profil",
    acad_teaching_title: "Lehre & Curriculum",
    acad_research_title: "Forschungsschwerpunkte",
    acad_cta_teaching: "Lehrpläne ansehen",
    acad_cta_research: "Publikationen ansehen",
    ov_title: "Methodik & Philosophie",
    res_title: "Forschung & Publikationen",
    res_links: "Akademische Profile",
    res_scholar: "Google Scholar",
    res_keywords: "Schlüsselwörter",
    teach_title: "Lehrpläne (16-Wochen-Pläne)",
    teach_focus: "Akademische Methodik",
    teach_delivery: "Durchführung & Bewertung",
    teach_expand: "Alle erweitern/reduzieren",
    exp_title: "Angewandte Industrieerfahrung",
    exp_strengths: "Operative Beiträge",
    exp_domains: "Industrielle Domänen",
    exp_examples: "Angewandte Beispiele",
    proj_title: "Technische Projekte",
    proj_stack: "Technologie-Stack",
    proj_value: "Wissenschaftlicher & Praktischer Wert",
    skills_title: "Technische & Akademische Fähigkeiten",
    skills_core: "Kerndisziplinen",
    skills_tools: "Software & Werkzeuge",
    skills_soft: "Akademische Soft Skills",
    skills_langs: "Sprachen",
    contact_title: "Kontakt aufnehmen",
    contact_email: "E-Mail senden",
    contact_whatsapp: "Nachricht über WhatsApp",
    hCoursesLbl: "Lehrpläne",
    hProjectsLbl: "Projekte",
    hPubsLbl: "Publikationen",
    footer: "© " + new Date().getFullYear() + " — Hani Mahfoud.",
    toastTranslated: "Automatisch übersetzt ✓"
  },
  fr: {
    audience: "Comités Académiques",
    nav_academic: "Profil Académique",
    nav_research: "Recherche",
    nav_teaching: "Plans de Cours",
    nav_experience: "Exp. Industrielle",
    nav_projects: "Projets",
    nav_skills: "Compétences",
    nav_contact: "Contact",
    acad_title: "Profil Académique",
    acad_teaching_title: "Enseignement & Curriculum",
    acad_research_title: "Axes de Recherche",
    acad_cta_teaching: "Voir les Plans de Cours",
    acad_cta_research: "Voir les Publications",
    ov_title: "Méthodologie & Philosophie",
    res_title: "Recherche & Publications",
    res_links: "Profils Académiques",
    res_scholar: "Google Scholar",
    res_keywords: "Mots-clés",
    teach_title: "Plans de Cours (16 Semaines)",
    teach_focus: "Méthodologie Académique",
    teach_delivery: "Évaluation & Organisation",
    teach_expand: "Développer/Réduire Tout",
    exp_title: "Expérience Industrielle Appliquée",
    exp_strengths: "Contributions Opérationnelles",
    exp_domains: "Domaines Industriels",
    exp_examples: "Exemples Appliqués",
    proj_title: "Projets Techniques",
    proj_stack: "Technologies",
    proj_value: "Valeur Scientifique & Pratique",
    skills_title: "Compétences Techniques & Académiques",
    skills_core: "Disciplines Principales",
    skills_tools: "Logiciels & Outils",
    skills_soft: "Compétences Transversales",
    skills_langs: "Langues",
    contact_title: "Me Contacter",
    contact_email: "Envoyer un e-mail",
    contact_whatsapp: "Message via WhatsApp",
    hCoursesLbl: "Plans de Cours",
    hProjectsLbl: "Projets",
    hPubsLbl: "Publications",
    footer: "© " + new Date().getFullYear() + " — Hani Mahfoud.",
    toastTranslated: "Traduit automatiquement ✓"
  },
  ro: {
    audience: "Comitete Academice",
    nav_academic: "Profil Academic",
    nav_research: "Cercetare",
    nav_teaching: "Programe Curs",
    nav_experience: "Exp. Industrială",
    nav_projects: "Proiecte",
    nav_skills: "Abilități",
    nav_contact: "Contact",
    acad_title: "Profil Academic",
    acad_teaching_title: "Predare & Curriculum",
    acad_research_title: "Axe de Cercetare",
    acad_cta_teaching: "Vezi Programele",
    acad_cta_research: "Vezi Publicațiile",
    ov_title: "Metodologie & Filosofie",
    res_title: "Cercetare & Publicații",
    res_links: "Profiluri Academice",
    res_scholar: "Google Scholar",
    res_keywords: "Cuvinte-cheie",
    teach_title: "Programe de Curs (16 Săptămâni)",
    teach_focus: "Metodologie Academică",
    teach_delivery: "Livrare & Evaluare",
    teach_expand: "Extinde/Restrânge",
    exp_title: "Experiență Industrială Aplicată",
    exp_strengths: "Contribuții Operaționale",
    exp_domains: "Domenii Industriale",
    exp_examples: "Exemple Aplicate",
    proj_title: "Proiecte Tehnice",
    proj_stack: "Tehnologii",
    proj_value: "Valoare Științifică & Practică",
    skills_title: "Abilități Tehnice & Academice",
    skills_core: "Discipline de Bază",
    skills_tools: "Software & Instrumente",
    skills_soft: "Abilități Academice",
    skills_langs: "Limbi",
    contact_title: "Contact",
    contact_email: "Trimite Email",
    contact_whatsapp: "Mesaj WhatsApp",
    hCoursesLbl: "Programe Curs",
    hProjectsLbl: "Proiecte",
    hPubsLbl: "Publicații",
    footer: "© " + new Date().getFullYear() + " — Hani Mahfoud.",
    toastTranslated: "Tradus automat ✓"
  }
};

let syllabusData = null;
let currentLang = "en";
let expandAll = false;

/* ========= Translation Engine (From Original Code) ========= */

function fnv1a(str){
  let h = 0x811c9dc5;
  for (let i=0;i<str.length;i++){
    h ^= str.charCodeAt(i);
    h = (h + ((h<<1)+(h<<4)+(h<<7)+(h<<8)+(h<<24))) >>> 0;
  }
  return ("0000000" + h.toString(16)).slice(-8);
}

function showToast(msg){
  const t = document.getElementById("toast");
  const tt = document.getElementById("toastText");
  tt.textContent = msg;
  t.classList.add("show");
  clearTimeout(showToast._to);
  showToast._to = setTimeout(()=>t.classList.remove("show"), 2200);
}

async function translateText(text, targetLang, sourceLang){
  const trimmed = (text || "").trim();
  if(!trimmed) return text;

  const sl = (sourceLang || "en").toLowerCase();
  const tl = (targetLang || "en").toLowerCase();
  if(sl === tl) return text;

  const cacheKey = "tr::" + sl + "::" + tl + "::" + fnv1a(trimmed);
  const cached = localStorage.getItem(cacheKey);
  if(cached) return cached;

  const store = (out)=>{
    if(out && typeof out === "string" && out.trim()){
      localStorage.setItem(cacheKey, out);
      return out;
    }
    return null;
  };

  try{
    const url = "https://api.mymemory.translated.net/get?q=" + encodeURIComponent(trimmed) + "&langpair=" + encodeURIComponent(sl + "|" + tl);
    const res = await fetch(url, {method:"GET"});
    if(res.ok){
      const data = await res.json();
      const out = data?.responseData?.translatedText;
      const saved = store(out);
      if(saved) return saved;
    }
  }catch(e){}

  try{
    const url = "https://translate.googleapis.com/translate_a/single?client=gtx&sl=" + encodeURIComponent(sl) + "&tl=" + encodeURIComponent(tl) + "&dt=t&q=" + encodeURIComponent(trimmed);
    const res = await fetch(url, {method:"GET"});
    if(res.ok){
      const data = await res.json();
      const out = Array.isArray(data?.[0]) ? data[0].map(x=>x?.[0]).filter(Boolean).join("") : null;
      const saved = store(out);
      if(saved) return saved;
    }
  }catch(e){}

  const endpoints = [
    "https://libretranslate.de/translate",
    "https://translate.argosopentech.com/translate",
    "https://libretranslate.com/translate"
  ];
  for(const url of endpoints){
    try{
      const res = await fetch(url, {
        method:"POST",
        headers: {"Content-Type":"application/json"},
        body: JSON.stringify({q: trimmed, source: sl, target: tl, format: "text"})
      });
      if(!res.ok) continue;
      const data = await res.json();
      const out = (data && (data.translatedText || data.translation)) ? (data.translatedText || data.translation) : null;
      const saved = store(out);
      if(saved) return saved;
    }catch(e){}
  }
  return text;
}

async function autoLangText(obj, lang){
  if(typeof obj === "string") return obj;
  if(obj[lang]) return obj[lang];
  const src = obj.en || obj.ar || "";
  const sourceLang = obj.en ? "en" : "ar";
  if(lang === sourceLang) return src;
  return await translateText(src, lang, sourceLang);
}

/* ========= UI Logic ========= */

function updateTheme(dark) {
  document.documentElement.setAttribute('data-theme', dark ? 'dark' : 'light');
  localStorage.setItem('theme', dark ? 'dark' : 'light');
  document.getElementById('themeBtn').innerHTML = dark ? '<i class="fa-solid fa-sun"></i>' : '<i class="fa-solid fa-moon"></i>';
}

function setActivePanel(panelId) {
  document.querySelectorAll(".panel").forEach(s => s.classList.remove("active"));
  document.querySelectorAll(".nav-btn").forEach(b => b.classList.remove("active"));
  
  const target = document.getElementById(panelId) || document.getElementById('academic');
  if(target) target.classList.add("active");
  
  const btn = document.querySelector(`.nav-btn[data-panel="${panelId}"]`);
  if(btn) btn.classList.add("active");
  
  window.scrollTo({top: 0, behavior:"smooth"});
}

async function renderContent(lang) {
  const ui = UI[lang] || UI.en;
  
  document.documentElement.dir = (lang === 'ar' || lang === 'fa') ? 'rtl' : 'ltr';
  document.documentElement.lang = lang;
  
  // Update UI Labels
  document.getElementById('audienceChip').querySelector('span').textContent = ui.audience;
  document.querySelectorAll('[data-i18n]').forEach(el => {
    const key = el.getAttribute('data-i18n');
    if(ui[key]) el.textContent = ui[key];
  });
  
  document.getElementById('hCoursesLbl').textContent = ui.hCoursesLbl;
  document.getElementById('hProjectsLbl').textContent = ui.hProjectsLbl;
  document.getElementById('hPubsLbl').textContent = ui.hPubsLbl;
  document.getElementById('footerText').textContent = ui.footer;
  document.getElementById("teachTranslateHint").textContent = BASE_CONTENT.teaching.translateHint[lang] || BASE_CONTENT.teaching.translateHint.en;
  
  // Profile
  document.getElementById('name').textContent = await autoLangText(PROFILE.name, lang);
  document.getElementById('role').textContent = await autoLangText(PROFILE.role, lang);
  document.getElementById('tagline').textContent = await autoLangText(PROFILE.tagline, lang);
  
  // Highlights
  document.getElementById("hCourses").textContent = syllabusData ? syllabusData.courses.length : "22";
  document.getElementById("hProjects").textContent = "3+";
  document.getElementById("hPubs").textContent = "3+";
  
  // Academic
  document.getElementById('acadTeachingP').textContent = await autoLangText(BASE_CONTENT.academic.teaching_p, lang);
  document.getElementById('acadResearchP').textContent = await autoLangText(BASE_CONTENT.academic.research_p, lang);
  
  const fillList = async (id, dataObj) => {
    const el = document.getElementById(id);
    if(!el) return;
    el.innerHTML = '';
    
    let arr = (lang === "ar") ? dataObj.ar : dataObj.en;
    if (lang !== "ar" && lang !== "en") {
      arr = await Promise.all(dataObj.en.map(x => translateText(x, lang, "en")));
    }
    
    if(Array.isArray(arr)) arr.forEach(txt => {
      const li = document.createElement('li'); li.textContent = txt; el.appendChild(li);
    });
  };
  
  await fillList('acadTeachingBullets', BASE_CONTENT.academic.teaching_bullets);
  await fillList('acadResearchBullets', BASE_CONTENT.academic.research_bullets);
  
  document.getElementById('ovPitch').textContent = await autoLangText(BASE_CONTENT.overview.pitch, lang);
  const pills = document.getElementById("ovPills"); pills.innerHTML = "";
  BASE_CONTENT.overview.pills.forEach(p=>{ const s=document.createElement("span"); s.className="pill"; s.textContent=p; pills.appendChild(s); });

  // Research
  document.getElementById('resIntroTitle').textContent = await autoLangText(BASE_CONTENT.research.intro, lang);
  const resList=document.getElementById("resList"); resList.innerHTML="";
  for (const it of BASE_CONTENT.research.list) {
    const li=document.createElement("li");
    const bodyText = await autoLangText(it, lang);
    li.innerHTML = `<strong>${it.k}:</strong> ${bodyText}`;
    resList.appendChild(li);
  }
  const resPills=document.getElementById("resPills"); resPills.innerHTML="";
  BASE_CONTENT.research.pills.forEach(p=>{ const s=document.createElement("span"); s.className="pill"; s.textContent=p; resPills.appendChild(s); });
  document.getElementById("scholarLink").href = PROFILE.scholar;

  // Teaching
  document.getElementById('teachIntro').textContent = await autoLangText(BASE_CONTENT.teaching.intro, lang);
  await fillList('teachFocus', BASE_CONTENT.teaching.focus);
  await fillList('teachDelivery', BASE_CONTENT.teaching.delivery);

  // Experience
  document.getElementById('expIntro').textContent = await autoLangText(BASE_CONTENT.experience.intro, lang);
  await fillList('expStrengths', BASE_CONTENT.experience.strengths);
  await fillList('expDomains', BASE_CONTENT.experience.domains);
  await fillList('expExamples', BASE_CONTENT.experience.examples);

  // Projects
  document.getElementById('projIntroTitle').textContent = await autoLangText(BASE_CONTENT.projects.intro, lang);
  const projList=document.getElementById("projList"); projList.innerHTML="";
  for (const it of BASE_CONTENT.projects.list) {
    const li=document.createElement("li");
    const bodyText = await autoLangText(it, lang);
    li.innerHTML = `<strong>${it.k}:</strong> ${bodyText}`;
    projList.appendChild(li);
  }
  const projPills=document.getElementById("projPills"); projPills.innerHTML="";
  BASE_CONTENT.projects.stack.forEach(p=>{ const s=document.createElement("span"); s.className="pill"; s.textContent=p; projPills.appendChild(s); });
  await fillList('projValue', BASE_CONTENT.projects.value);

  // Skills
  await fillList('skillsCore', BASE_CONTENT.skills.core);
  await fillList('skillsSoft', BASE_CONTENT.skills.soft);
  await fillList('skillsLangs', BASE_CONTENT.skills.langs);
  const skPills=document.getElementById("skillsPills"); skPills.innerHTML="";
  BASE_CONTENT.skills.tools.forEach(p=>{ const s=document.createElement("span"); s.className="pill"; s.textContent=p; skPills.appendChild(s); });

  // Contact
  document.getElementById('contactIntro').textContent = await autoLangText(BASE_CONTENT.contact.intro, lang);
  const contactList=document.getElementById("contactList"); contactList.innerHTML="";
  const loc = await autoLangText(PROFILE.location, lang);
  contactList.innerHTML = `<li><i class="fa-solid fa-location-dot" style="width:20px; color:var(--primary)"></i> ${loc}</li>
                           <li><i class="fa-solid fa-at" style="width:20px; color:var(--primary)"></i> ${PROFILE.email}</li>`;
  document.getElementById('mailBtn').href = "mailto:" + PROFILE.email;
  document.getElementById('waBtn').href = PROFILE.whatsapp;

  renderCourses(lang);
}

function renderCourses(lang) {
  const list = document.getElementById("courseList");
  const q = (document.getElementById("courseSearch").value || "").trim().toLowerCase();
  list.innerHTML = "";
  
  if(!syllabusData || !syllabusData.courses) return;

  const courses = syllabusData.courses.filter(c => (c.title_en + " " + c.title_ar).toLowerCase().includes(q));

  courses.forEach((c, idx) => {
    const details = document.createElement("details");
    details.className = "course card";
    details.style.padding = "0";

    const summary = document.createElement("summary");
    
    // Default Description logic
    let initialDesc = (lang === "ar") ? c.description_ar : c.description_en;
    
    summary.innerHTML = `
      <div>
        <div class="c-title">${lang === 'ar' ? c.title_ar + " | " + c.title_en : c.title_en + " | " + c.title_ar}</div>
        <div class="c-desc" data-initial-desc="1">${initialDesc}</div>
      </div>
      <div class="badge">16 Weeks</div>
    `;

    const body = document.createElement("div");
    body.className = "course-body";
    
    // Structural skeleton to be filled dynamically
    body.innerHTML = `
      <div class="subhead">${lang === 'ar' ? 'منهجية التدريس' : 'Teaching Methodology'}</div>
      <p style="font-size:0.9rem; color:var(--muted); margin-bottom:10px;" data-field="methods">—</p>
      
      <div class="subhead">${lang === 'ar' ? 'مخرجات التعلم' : 'Learning Outcomes'}</div>
      <ul class="clean" style="font-size:0.9rem;" data-field="outcomes"></ul>
      
      <div class="subhead">${lang === 'ar' ? 'الخطة الأسبوعية' : 'Weekly Syllabus'}</div>
      <div data-field="weeks"></div>
    `;

    details.appendChild(summary);
    details.appendChild(body);
    list.appendChild(details);

    // Lazy load the heavy translations only when expanded
    const fill = async () => {
      // Fix Description if language is not EN or AR
      if (lang !== "ar" && lang !== "en") {
        const descEl = summary.querySelector('[data-initial-desc="1"]');
        if (descEl) descEl.textContent = await translateText(c.description_en, lang, "en");
      }

      const methodsEl = body.querySelector('[data-field="methods"]');
      const outcomesEl = body.querySelector('[data-field="outcomes"]');
      const weeksEl = body.querySelector('[data-field="weeks"]');

      // Methods
      let methodsText = c.teaching_methods_ar || "";
      if (lang === "en") methodsText = await translateText(methodsText, "en", "ar");
      else if (lang !== "ar") methodsText = await translateText(await translateText(methodsText, "en", "ar"), lang, "en");
      methodsEl.textContent = methodsText || "—";

      // Outcomes (Batch Translation)
      outcomesEl.innerHTML = "";
      let outs = c.outcomes_ar || [];
      if (lang !== "ar") {
        const joined = outs.join("\n###\n");
        let translated = await translateText(joined, (lang==="en")? "en" : lang, "ar");
        outs = (translated || joined).split("\n###\n").map(s=>s.trim()).filter(Boolean);
      }
      outs.forEach(t => { const li = document.createElement("li"); li.textContent = t; outcomesEl.appendChild(li); });

      // Weeks
      weeksEl.innerHTML = "";
      const weeksData = c.outline_ar || [];
      for(const w of weeksData) {
        const wk = document.createElement("div");
        wk.className = "week";
        
        let titleText = `Week ${w.week}: ${w.title}`;
        if (lang === "ar") titleText = `الأسبوع ${w.week}: ${w.title}`;
        else if (lang === "en") titleText = await translateText(`الأسبوع ${w.week}: ${w.title}`, "en", "ar");
        else titleText = await translateText(`الأسبوع ${w.week}: ${w.title}`, lang, "ar");

        const ul = document.createElement("ul");
        ul.style.marginTop = "6px"; ul.style.paddingInlineStart = "20px"; ul.style.fontSize = "0.9rem";
        
        let itTexts = w.items || [];
        if(lang !== "ar"){
          const joined = itTexts.join("\n###\n");
          const translated = await translateText(joined, lang, "ar");
          itTexts = (translated || joined).split("\n###\n").map(s=>s.trim()).filter(Boolean);
        }

        wk.innerHTML = `<strong>${titleText}</strong>`;
        itTexts.forEach(t => { const li = document.createElement("li"); li.textContent = t; ul.appendChild(li); });
        wk.appendChild(ul);
        weeksEl.appendChild(wk);
      }

      showToast((UI[lang] || UI.en).toastTranslated);
    };

    details.addEventListener("toggle", async () => {
      if(details.open && !details.dataset.filled){
        details.dataset.filled = "1";
        await fill();
      }
    });

    if(expandAll) {
      details.open = true;
      details.dataset.filled = "1";
      fill();
    }
  });

  if(!courses.length){
    const empty = document.createElement("div");
    empty.className="card";
    empty.textContent = (lang==="ar" || lang==="fa") ? "لا توجد نتائج." : "No results.";
    list.appendChild(empty);
  }
}

document.addEventListener('DOMContentLoaded', async () => {
  // Theme init
  const isDark = localStorage.getItem('theme') === 'dark';
  updateTheme(isDark);
  document.getElementById('themeBtn').addEventListener('click', () => {
    updateTheme(document.documentElement.getAttribute('data-theme') !== 'dark');
  });

  // Nav routing
  document.querySelectorAll('.nav-btn, [data-jump]').forEach(btn => {
    btn.addEventListener('click', () => setActivePanel(btn.dataset.panel || btn.dataset.jump));
  });

  // Lang routing
  document.querySelectorAll('.lang-btn').forEach(btn => {
    btn.addEventListener('click', async (e) => {
      document.querySelectorAll('.lang-btn').forEach(b => b.classList.remove('active'));
      e.target.classList.add('active');
      currentLang = e.target.dataset.lang;
      await renderContent(currentLang);
    });
  });

  // Load syllabus
  try {
    const res = await fetch("syllabus.json");
    syllabusData = await res.json();
  } catch(e) { console.error("Could not load syllabus"); }

  // Search & Expand
  document.getElementById('courseSearch').addEventListener('input', () => renderCourses(currentLang));
  document.getElementById('expandAllBtn').addEventListener('click', () => { expandAll = !expandAll; renderCourses(currentLang); });

  // Initial render
  document.querySelector(`.lang-btn[data-lang="en"]`).classList.add('active');
  await renderContent('en');
});

/* ===== Botpress: Custom Launcher & Multilingual Hints ===== */
(function(){
  const hints = {
    ar: "اسألني",
    en: "Ask me",
    fa: "از من بپرس",
    de: "Frag mich",
    fr: "Demande-moi",
    ro: "Întreabă-mă"
  };

  const aria = {
    ar: "افتح الدردشة",
    en: "Open chat",
    fa: "باز کردن چت",
    de: "Chat öffnen",
    fr: "Ouvrir le chat",
    ro: "Deschide chatul"
  };

  const btn = document.getElementById("bp-toggle-chat");
  const hintEl = document.getElementById("bp-chat-hint");

  function siteLang(){
    try{
      if (typeof currentLang !== "undefined" && currentLang) return String(currentLang);
    }catch(e){}
    const lang = document.documentElement.getAttribute("lang") || "en";
    return lang.split("-")[0];
  }

  function applyHint(){
    const lang = siteLang();
    const text = hints[lang] || hints.en;
    if (hintEl) hintEl.textContent = text;

    const label = aria[lang] || aria.en;
    if (btn) btn.setAttribute("aria-label", label);
    if (hintEl) hintEl.setAttribute("aria-label", label);
  }

  let pendingOpen = false;

  function openChat(){
    if (window.botpress && typeof window.botpress.open === "function") {
      window.botpress.open();
      return true;
    }
    return false;
  }

  function toggleChat(){
    if (window.botpress && typeof window.botpress.toggle === "function") {
      window.botpress.toggle();
      return true;
    }
    return openChat();
  }

  function safeToggle(){
    const ok = toggleChat();
    if (!ok) pendingOpen = true;
  }

  function keyActivate(e){
    if (e.key === "Enter" || e.key === " ") {
      e.preventDefault();
      safeToggle();
    }
  }

  if (btn){
    btn.addEventListener("click", safeToggle);
    btn.addEventListener("keydown", keyActivate);
  }
  if (hintEl){
    hintEl.addEventListener("click", safeToggle);
    hintEl.addEventListener("keydown", keyActivate);
  }

  applyHint();
  const mo = new MutationObserver(() => applyHint());
  mo.observe(document.documentElement, { attributes: true, attributeFilter: ["lang", "dir"] });

  function updateContext(){
    const lang = siteLang();
    const section = (document.querySelector('section.panel.active') || {id:"academic"}).id;
    if (window.botpress && typeof window.botpress.updateUser === "function"){
      window.botpress.updateUser({
        data: { siteLang: lang, siteSection: section, site: "portfolio_academic" }
      }).catch(()=>{});
    }
  }

  try{
    if (window.botpress && typeof window.botpress.on === "function"){
      window.botpress.on("webchat:initialized", () => {
        applyHint();
        updateContext();
        if (pendingOpen){
          pendingOpen = false;
          openChat();
        }
      });
    } else {
      let tries = 0;
      const t = setInterval(() => {
        tries++;
        if (window.botpress && typeof window.botpress.on === "function"){
          clearInterval(t);
          window.botpress.on("webchat:initialized", () => {
            applyHint();
            updateContext();
            if (pendingOpen){
              pendingOpen = false;
              openChat();
            }
          });
        }
        if (tries > 40) clearInterval(t);
      }, 250);
    }
  }catch(e){}

  document.querySelectorAll('.nav-btn, [data-jump]').forEach(b => {
      b.addEventListener('click', () => setTimeout(updateContext, 50));
  });
})();
</script>
</body>
</html>
